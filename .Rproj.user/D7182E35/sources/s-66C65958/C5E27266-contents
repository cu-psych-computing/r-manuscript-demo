###### R Club Manuscript Workshop ######

### Putting together some example code


## Load bmlm package to access example dataset
library(bmlm)
library(papaja)

# for simplicity, we will only look at data from the first time point
mydata <- subset(BLch9, time == 1)


### some analyses ####

model1 <- lm(m ~ x, data = mydata)
summary(model1)

model2 <- lm(y ~ x, data = mydata)
summary(model2)

### combining DVs in a table ####

library(broom)
library(tidyr)

kzregtable <- function(x) {
  modtidy <- tidy(x)
  citidy <- tidy(confint(x))
  citidy$term <- citidy[,1]
  tidymerged <- merge(modtidy, citidy, by = "term")
  tidymerged$var <- paste(x$terms)[2]
  tidymerged$df <- x$df.residual
  colnames(tidymerged) <- c("term", "estimate", "std.error", "t.value", 
                            "p.value", "term2", "lower", "upper", "var", "df")
  tidymerged$p.round <- ifelse(tidymerged$p.value < .001, "<.001", format(round(tidymerged$p.value, digits =3), nsmall = 3))
  tidymerged$estimate.round <-  format(round(tidymerged$estimate, digits =2), nsmall = 2)
  tidymerged$t.value.round <- format(round(tidymerged$t.value, digits =2), nsmall = 2)
  tidymerged$lower.round <- format(round(tidymerged$lower, digits =2), nsmall = 2)
  tidymerged$upper.round <- format(round(tidymerged$upper, digits = 2), nsmall = 2)
  tidymerged$std.error.round <- format(round(tidymerged$std.error, digits = 2), nsmall = 2)
  tidymerged$r <- sqrt(tidymerged$t.value^2/(tidymerged$t.value^2+tidymerged$df))
  tidymerged$err <- (1/sqrt(nobs(x)-3))
  tidymerged$r.round <- format(round(tidymerged$r, digits = 2), nsmall = 2)
  tidymerged$err.round <- format(round(tidymerged$err, digits = 2), nsmall = 2)
  tidymerged2 <- dplyr::select(tidymerged, var, term, estimate.round, std.error.round, t.value.round, df, p.round,
                               lower.round, upper.round, r.round, err.round)
  colnames(tidymerged2) <- c("var", "term", "estimate", "se", "t", "df", "p", "lwr", "upr", "r", "err")
  print(tidymerged2)
}


dv1 <- kzregtable(model1)
dv2 <- kzregtable(model2)

resultsummary <- rbind(dv1, dv2)


